def load_app_files_for_completions
  original_completion_proc = Readline.completion_proc
  Readline.completion_proc = proc{ |input|
    begin
      old_verbose, $VERBOSE = $VERBOSE, nil
      (Dir.glob('app/**/*.rb') + Dir.glob('lib/**/*.rb')).each do |rb|
        require rb
      end
    ensure
      $VERBOSE = old_verbose
    end

    Readline.completion_proc = original_completion_proc
    original_completion_proc.call(input)
  }
end

def r
  ret = reload!
  load_app_files_for_completions
  ret
end

def sql(query)
  ActiveRecord::Base.connection.select_all(query)
end

load_app_files_for_completions
